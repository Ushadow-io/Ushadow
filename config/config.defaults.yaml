# Default Configuration
# All application defaults in one place. User overrides go in config.overrides.yaml.
#
# DO NOT store secrets here - use secrets.yaml for API keys and passwords.

version: 1.0.0
wizard_completed: false

# Environment Settings
environment:
  name: ushadow
  mode: development  # development | production
  debug: false

# Authentication Configuration (non-sensitive)
auth:
  admin_email: admin@example.com
  admin_name: admin

# Keycloak OAuth Configuration
# Uses KC_* environment variables (Keycloak's native format)
keycloak:
  url: ${oc.env:KC_URL,http://keycloak:8080}                    # Internal URL (backend→Keycloak admin API)
  public_url: ${oc.env:KC_HOSTNAME_URL,http://localhost:8081}   # Browser/web URL (OAuth redirects, token issuer)
  mobile_url: ${oc.env:KC_MOBILE_URL,''}                         # Mobile URL override; auto-derived from Tailscale IP if empty
  realm: ${oc.env:KC_REALM,ushadow}
  backend_client_id: ${oc.env:KC_BACKEND_CLIENT_ID,ushadow-backend}
  frontend_client_id: ${oc.env:KC_FRONTEND_CLIENT_ID,ushadow-frontend}
  admin_user: ${oc.env:KC_BOOTSTRAP_ADMIN_USERNAME,admin}
  admin_password: ${oc.env:KC_BOOTSTRAP_ADMIN_PASSWORD,admin}
  cli_client_id: ${oc.env:KEYCLOAK_CLI_CLIENT_ID,ushadow-cli}  # CLI tools (ush) with direct grant

# Speech Detection Settings
speech_detection:
  min_words: 5
  min_confidence: 0.5
  min_duration: 10.0

# Conversation Management Settings
conversation:
  transcription_buffer_seconds: 120.0
  speech_inactivity_threshold: 60.0
  new_conversation_timeout_minutes: 1.5
  record_only_enrolled_speakers: true

# Audio Processing Settings
audio_processing:
  audio_cropping_enabled: true
  min_speech_segment_duration: 1.0
  cropping_context_padding: 0.1

# Speaker Diarization Settings
diarization:
  diarization_source: pyannote
  similarity_threshold: 0.15
  min_duration: 0.5
  collar: 2.0
  min_duration_off: 1.5
  min_speakers: 2
  max_speakers: 6

# LLM Configuration
llm:
  provider: openai
  openai_model: gpt-4o-mini
  chat_temperature: 0.7
  ollama_model: llama3.1:latest
  ollama_embedder_model: nomic-embed-text:latest
  ollama_base_url: http://ollama:11434

# Transcription Configuration
transcription:
  provider: deepgram
  language: en

# Service-Specific Preferences (not shared across services)
service_preferences:
  chronicle:
    database: ushadow
  openmemory:
    enable_graph: false
    neo4j_password: null

# Server Runtime
server:
  config_dir: ${oc.env:CONFIG_DIR,/config}

# Tailscale
tailscale:
  container_name: ${oc.env:TAILSCALE_CONTAINER,tailscale}

# Network Configuration
network:
  host_ip: localhost
  backend_public_port: 8000
  webui_port: 5173

# Security Configuration
security:
  # Merges CORS_ORIGINS env var with defaults (deduplicates)
  cors_origins: ${merge_csv:${oc.env:CORS_ORIGINS},http://localhost:5173,http://localhost:3000,http://localhost:1421,http://127.0.0.1:5173,http://127.0.0.1:3000}

# Infrastructure Services
infrastructure:
  mongodb_uri: ${oc.env:MONGODB_URI,mongodb://mongo:27017}
  mongodb_database: ${oc.env:MONGODB_DATABASE,ushadow}  # Default database name (NOT a URI!)
  redis_url: ${oc.env:REDIS_URL,redis://redis:6379/0}
  
  qdrant_base_url: qdrant
  qdrant_port: '6333'

  neo4j_user: neo4j
  neo4j_url: bolt://neo4j:7687
  neo4j_db: neo4j

  ollama_base_url: http://ollama:11434
  openai_base_url: https://api.openai.com/v1
  # DEPRECATED: This default is for local dev only. The backend should dynamically
  # set this to the internal proxy URL when starting Chronicle.
  # TODO: Remove this once backend sets MEMORY_SERVER_URL dynamically
  memory_server_url: http://mem0:8765

# Miscellaneous Settings
misc:
  debug_dir: ./data/debug_dir
  langfuse_enable_telemetry: false

# ─────────────────────────────────────────────────────────────────────────────
# Service & Provider Defaults
# ─────────────────────────────────────────────────────────────────────────────

# Wizard Configuration
wizard:
  mode: quickstart  # quickstart | local | custom

# Selected Providers per Capability
# Services declare `uses: [{capability: llm}]` and get the selected provider's env vars.
selected_providers:
  llm: openai                   # openai | anthropic | ollama | openai-compatible
  transcription: deepgram       # deepgram | mistral-voxtral | whisper-local | parakeet
  memory: openmemory            # openmemory | cognee | mem0-cloud

# Default Services to Install
# These are installed by default in quickstart mode. User modifications
# (adds/removes) are tracked in config.overrides.yaml → installed_services.
default_services:
  - chronicle-backend
  - chronicle-workers
  - mem0

# Feed Configuration
# Sources are managed here (config.overrides.yaml for user additions).
# YouTube API key is stored in secrets.yaml under api_keys.youtube_api_key.
feed:
  sources: []
